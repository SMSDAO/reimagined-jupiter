# ðŸ§¹ Automated Cleanup Analysis

This directory contains scripts and tools for the automated cleanup workflow.

## Overview

The automated cleanup workflow runs on every Pull Request to continuously optimize the repository by removing unused code, dependencies, and configurations with zero regressions.

## Scripts

### intelligent-analyzer.js

Analyzes the codebase using multiple static and dynamic analysis techniques to identify removal candidates.

**Features:**
- Heuristic scoring system (0-100 points)
- Security-critical pattern detection
- Coverage-based dead code detection
- Dependency graph analysis
- Stale code detection (180+ days)
- Complexity analysis

**Scoring System:**
- Never Executed Code: +40 points (0% coverage)
- Unused Exports: +30 points
- Stale Code: +20 points (not modified in 180+ days)
- High Complexity + Low Usage: +25 points
- Unused Config Files: +35 points
- Security-Critical: -1000 points (blocked)

**Usage:**
```bash
node intelligent-analyzer.js [analysis-directory]
```

### execute-cleanup.js

Safely executes cleanup operations based on the intelligent analysis results.

**Features:**
- Safe dependency removal (score >70)
- Safe file deletion (score >85)
- Export disabling via comments (score >75)
- Audit trail generation
- Rollback support

**Usage:**
```bash
node execute-cleanup.js [analysis-directory]
```

## Security-Critical Patterns

The following patterns are **NEVER** removed (receive -1000 score):

- `admin` - Administration logic
- `auth` / `authentication` - Authentication systems
- `dao` / `governance` - DAO governance
- `security` / `crypto` / `signature` - Security primitives
- `wallet` / `transaction` / `token` - Blockchain operations
- `solana` / `jupiter` / `arbitrage` - Core platform logic
- `flash.*loan` - Flash loan functionality

## Analysis Files

The workflow generates the following analysis files:

- `unused-exports.txt` - Unused TypeScript/JavaScript exports
- `unused-deps.json` - Unused npm dependencies
- `circular-deps.txt` - Circular dependency warnings
- `python-dead-code.txt` - Python dead code (vulture)
- `complexity.json` - Code complexity metrics (radon)
- `dep-graph.json` - Dependency graph structure
- `import-usage.json` - Import usage patterns
- `removal-candidates.json` - Scored removal candidates
- `cleanup-summary.md` - Human-readable summary

## Validation Pipeline

After cleanup, the workflow runs a comprehensive validation pipeline:

1. **Rebuild** - Compile TypeScript backend and Next.js webapp
2. **Test** - Run full test suite (backend + webapp)
3. **Type Check** - Validate TypeScript types
4. **Lint** - Run ESLint on all code

If any validation step fails, changes are automatically rolled back.

## Zero Regression Guarantee

The workflow guarantees zero regressions through:

1. **Test-Aware Pruning** - Only removes code with 0% test coverage
2. **Security Preservation** - Never touches security-critical paths
3. **Full Validation** - Complete rebuild + test + typecheck + lint
4. **Auto-Rollback** - Reverts changes on any failure
5. **Artifact Upload** - Complete audit trail (30 days retention)

## Workflow Integration

The workflow is triggered automatically on every PR to `main`:

```yaml
on:
  pull_request:
    branches:
      - main
    types: [opened, synchronize, reopened]
```

## Manual Execution

To run analysis locally:

```bash
# Install analysis tools
npm install -g depcheck madge ts-unused-exports
pip install vulture radon coverage

# Run tests with coverage
npm test -- --coverage

# Create analysis directory
mkdir -p .cleanup-analysis

# Run analysis
node .cleanup-analysis/intelligent-analyzer.js .cleanup-analysis

# Execute cleanup (review changes first!)
node .cleanup-analysis/execute-cleanup.js .cleanup-analysis
```

## Artifacts

All analysis results are uploaded as GitHub Actions artifacts with 30-day retention for audit purposes.

## Contributing

When modifying the cleanup scripts:

1. Test thoroughly on a feature branch
2. Ensure security-critical patterns are preserved
3. Validate zero-regression guarantee
4. Update this README with any changes

---

**Generated by GXQ STUDIO**
*Automated cleanup for continuous optimization*
